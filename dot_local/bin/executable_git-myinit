#!/bin/sh
# git-myinit - Initialize a new git repo with empty initial commit
#
# Usage: git-myinit [directory]
#
# Creates a new git repository with an empty initial commit. This makes
# rebasing easier since you always have a root commit to rebase onto.
#
# If directory is specified, creates and initializes that directory.
# Otherwise, initializes the current directory.
#
# Safety checks:
#   - Won't clobber an existing .git directory
#   - Won't run inside an existing git repository

set -e

dir="${1:-.}"

# If directory specified and doesn't exist, create it
if [ "$dir" != "." ] && [ ! -d "$dir" ]; then
    echo "Creating directory: $dir"
    mkdir -p "$dir"
fi

cd "$dir"

# Check if we're already inside a git repo
if git rev-parse --git-dir >/dev/null 2>&1; then
    echo "Error: Already inside a git repository" >&2
    git_root=$(git rev-parse --show-toplevel 2>/dev/null || echo "(bare repo)")
    echo "  Git root: $git_root" >&2
    exit 1
fi

# Check if .git already exists (shouldn't happen after above check, but be safe)
if [ -e ".git" ]; then
    echo "Error: .git already exists in $(pwd)" >&2
    exit 1
fi

echo "Initializing git repository in: $(pwd)"
git init

echo "Creating empty initial commit..."
git commit --allow-empty -m "Initial commit"

echo ""
echo "Done! Repository initialized with empty initial commit."
echo "  Branch: $(git branch --show-current)"
echo "  Commit: $(git rev-parse --short HEAD)"
