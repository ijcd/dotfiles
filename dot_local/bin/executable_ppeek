#!/bin/sh
# ppeek - Pipeline peek (tee to stderr)
#
# Usage: ppeek [prefix]
#
# Reads lines from stdin and writes to both stdout and stderr.
# Useful for debugging pipelines - see intermediate data while
# still passing it through.
#
# Arguments:
#   prefix    String to prepend to stderr output (default: "> ")
#
# Examples:
#   cat file | ppeek | wc -l     # See lines AND count them
#   curl url | ppeek "API: " | jq .  # Debug API response
#
# The prefix helps distinguish ppeek output from other stderr.

set -e

prefix="${1:-> }"
while read -r line; do
  echo "$line"
  echo "$prefix$line" >&2
done
